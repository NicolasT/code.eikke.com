<!DOCTYPE html PUBLIC "-//IETF//DTD HTML 2.0//EN">
<HTML>

<!-- Mirrored from code.eikke.com/bash/sysstats.sh.html by HTTrack Website Copier/3.x [XR&CO'2010], Tue, 11 Dec 2012 21:31:03 GMT -->
<HEAD>
<TITLE>Enscript Output</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#1F00FF" ALINK="#FF0000" VLINK="#9900DD">
<A NAME="top">
<A NAME="file1">
<H1>sysstats.sh</H1>

<PRE>
<B><FONT COLOR="#5F9EA0">#!/bin/bash
</FONT></B>
<I><FONT COLOR="#B22222"># Gather system information, can e.g. be sent to | mail in a cronjob
</FONT></I><I><FONT COLOR="#B22222">#
</FONT></I><I><FONT COLOR="#B22222"># Copyright (C) 2005 Nicolas &quot;Ikke&quot; Trangez (eikke eikke commercial)
</FONT></I><I><FONT COLOR="#B22222">#
</FONT></I><I><FONT COLOR="#B22222"># This program is free software; you can redistribute it and/or
</FONT></I><I><FONT COLOR="#B22222"># modify it under the terms of the GNU General Public License as
</FONT></I><I><FONT COLOR="#B22222"># published by the Free Software Foundation; either version 2 of the
</FONT></I><I><FONT COLOR="#B22222"># License, or (at your option) any later version.
</FONT></I><I><FONT COLOR="#B22222">#
</FONT></I><I><FONT COLOR="#B22222"># This program is distributed in the hope that it will be useful, but
</FONT></I><I><FONT COLOR="#B22222"># WITHOUT ANY WARRANTY; without even the implied warranty of
</FONT></I><I><FONT COLOR="#B22222"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
</FONT></I><I><FONT COLOR="#B22222"># General Public License for more details.
</FONT></I><I><FONT COLOR="#B22222">#
</FONT></I><I><FONT COLOR="#B22222"># You should have received a copy of the GNU General Public License
</FONT></I><I><FONT COLOR="#B22222"># along with this program; if not, write to the Free Software
</FONT></I><I><FONT COLOR="#B22222"># Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
</FONT></I><I><FONT COLOR="#B22222"># 02111-1307, USA.
</FONT></I>
<I><FONT COLOR="#B22222"># ChangeLog
</FONT></I><I><FONT COLOR="#B22222"># ---------
</FONT></I><I><FONT COLOR="#B22222"># 05/17/05: Initial version
</FONT></I>
<I><FONT COLOR="#B22222"># TODO
</FONT></I><I><FONT COLOR="#B22222"># ----
</FONT></I><I><FONT COLOR="#B22222"># * Netstat output
</FONT></I><I><FONT COLOR="#B22222"># * Memory/swap information
</FONT></I><I><FONT COLOR="#B22222"># * ifconfig information
</FONT></I><I><FONT COLOR="#B22222"># * Make output dependent on argv
</FONT></I><I><FONT COLOR="#B22222"># * md5sum checks                               (done)
</FONT></I><I><FONT COLOR="#B22222"># * Keep previeous values and compare
</FONT></I>
<I><FONT COLOR="#B22222"># HOWTO
</FONT></I><I><FONT COLOR="#B22222"># -----
</FONT></I><I><FONT COLOR="#B22222"># * To get system info, just run the script: sh sysstat.sh
</FONT></I><I><FONT COLOR="#B22222">#
</FONT></I><I><FONT COLOR="#B22222"># * To enable md5 checksum checking, you need a file called &quot;md5sums.lst&quot; in
</FONT></I><I><FONT COLOR="#B22222"># *    the current directory.
</FONT></I><I><FONT COLOR="#B22222"># * This file should be formatted like this:
</FONT></I><I><FONT COLOR="#B22222">#       /path/to/file:md5sum
</FONT></I><I><FONT COLOR="#B22222"># * where &quot;/path/to/file&quot; must start with a &quot;/&quot;
</FONT></I><I><FONT COLOR="#B22222"># * An example:
</FONT></I><I><FONT COLOR="#B22222">#       /etc/passcd:r154j3054475f984d71edf67d5800718
</FONT></I><I><FONT COLOR="#B22222">#
</FONT></I><I><FONT COLOR="#B22222"># * You can run this script in a crontab.
</FONT></I><I><FONT COLOR="#B22222"># * You could call it like this (in a wrapper script):
</FONT></I><I><FONT COLOR="#B22222">#       cd /path/to/sysstat/script
</FONT></I><I><FONT COLOR="#B22222">#       sh /path/to/sysstat/script/sysstats.sh | mail -s &quot;System information for `hostname`&quot; ikke@somehost
</FONT></I><I><FONT COLOR="#B22222"># * We need to cd to make sure we can find md5sums.lst
</FONT></I>
<I><FONT COLOR="#B22222">####################### DO NOT EDIT UNDER THIS LINE ###########################
</FONT></I>
siheader() {
        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;================================================================&quot;</FONT></B>
        <B><FONT COLOR="#DA70D6">echo</FONT></B> -e <B><FONT COLOR="#BC8F8F">&quot;* System statistics for: \t`hostname`.`dnsdomainname`&quot;</FONT></B>
        <B><FONT COLOR="#DA70D6">echo</FONT></B> -e <B><FONT COLOR="#BC8F8F">&quot;* Generated on: \t\t`date`&quot;</FONT></B>
        <B><FONT COLOR="#DA70D6">echo</FONT></B> -e <B><FONT COLOR="#BC8F8F">&quot;* Running as: \t\t\t`whoami`&quot;</FONT></B>
        <B><FONT COLOR="#DA70D6">echo</FONT></B>
}

fuptime() {
        upSeconds=$(cat /proc/uptime | tr <B><FONT COLOR="#BC8F8F">&quot;.&quot;</FONT></B> <B><FONT COLOR="#BC8F8F">&quot; &quot;</FONT></B> | awk '{print $1}')
        secs=$((${upSeconds}%60))
        mins=$((${upSeconds}/60%60))
        hours=$((${upSeconds}/3600/24))
        days=$((${upSeconds}/86400))
        <B><FONT COLOR="#A020F0">if</FONT></B> [ <B><FONT COLOR="#BC8F8F">&quot;${days}&quot;</FONT></B> -ne <B><FONT COLOR="#BC8F8F">&quot;0&quot;</FONT></B> ]
        <B><FONT COLOR="#A020F0">then</FONT></B>
                <B><FONT COLOR="#DA70D6">echo</FONT></B> -n <B><FONT COLOR="#BC8F8F">&quot;${days} days, &quot;</FONT></B>
        <B><FONT COLOR="#A020F0">fi</FONT></B>
        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;`printf '%02d' ${hours}`:`printf '%02d' ${mins}`:`printf '%02d' ${secs}`&quot;</FONT></B>
}

siuptime() {
        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;=================== Uptime =====================================&quot;</FONT></B>
        <B><FONT COLOR="#DA70D6">echo</FONT></B> -e <B><FONT COLOR="#BC8F8F">&quot;* Uptime: \t\t\t`fuptime`&quot;</FONT></B>
        <B><FONT COLOR="#A020F0">if</FONT></B> [ -x /usr/bin/uprecords ];
        <B><FONT COLOR="#A020F0">then</FONT></B>
                <B><FONT COLOR="#DA70D6">echo</FONT></B> -e <B><FONT COLOR="#BC8F8F">&quot;* High score: \t\t\t`uprecords | tail -n1 | cut -d'|' -f1 | cut -d'n' -f3 | sed 's/^[[:blank:]]*//'`&quot;</FONT></B>
        <B><FONT COLOR="#A020F0">fi</FONT></B>
        <B><FONT COLOR="#DA70D6">echo</FONT></B> -e <B><FONT COLOR="#BC8F8F">&quot;* Load average: \t\t`cat /proc/loadavg | head -c14`&quot;</FONT></B>
        <B><FONT COLOR="#DA70D6">echo</FONT></B>
}

fw () {
        OFS=${<FONT COLOR="#B8860B">IFS</FONT>}
        <FONT COLOR="#B8860B">IFS</FONT>=$'\n'
        CNT=$(<B><FONT COLOR="#DA70D6">echo</FONT></B> `w | wc -l`-1 | bc)

        w | tail -n ${CNT} | <B><FONT COLOR="#A020F0">while</FONT></B> <B><FONT COLOR="#DA70D6">read</FONT></B> -r a;
        <B><FONT COLOR="#A020F0">do</FONT></B>
                <B><FONT COLOR="#DA70D6">echo</FONT></B> -e <B><FONT COLOR="#BC8F8F">&quot;\t${a}&quot;</FONT></B>
        <B><FONT COLOR="#A020F0">done</FONT></B>

        <FONT COLOR="#B8860B">IFS</FONT>=${OFS}
}

siusers() {
        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;=================== Users ======================================&quot;</FONT></B>
        <B><FONT COLOR="#DA70D6">echo</FONT></B> -e <B><FONT COLOR="#BC8F8F">&quot;* Active users: \t\t`who | wc -l`&quot;</FONT></B>
        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;* User information&quot;</FONT></B>
        fw
        <B><FONT COLOR="#DA70D6">echo</FONT></B>
}

fpstree() {
        OFS=${<FONT COLOR="#B8860B">IFS</FONT>}
        <FONT COLOR="#B8860B">IFS</FONT>=$'\n'
        pstree | <B><FONT COLOR="#A020F0">while</FONT></B> <B><FONT COLOR="#DA70D6">read</FONT></B> -r a;
        <B><FONT COLOR="#A020F0">do</FONT></B>
                <B><FONT COLOR="#DA70D6">echo</FONT></B> -e <B><FONT COLOR="#BC8F8F">&quot;\t${a}&quot;</FONT></B>
        <B><FONT COLOR="#A020F0">done</FONT></B>
        <FONT COLOR="#B8860B">IFS</FONT>=${OFS}
}

fcomms() {
        ps -eo comm | sort | uniq | grep -v ^COMMAND | column
        <B><FONT COLOR="#DA70D6">echo</FONT></B>

        <FONT COLOR="#B8860B">IFS</FONT>=${OFS}
}

fprocs() {
        <B><FONT COLOR="#DA70D6">echo</FONT></B> `TERM=Linux top -n1 -b | grep <B><FONT COLOR="#BC8F8F">&quot;Tasks&quot;</FONT></B> | awk '{print $4,$6,$8,$10}'`
}

sitasks() {
        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;=================== Tasks ======================================&quot;</FONT></B>
        <B><FONT COLOR="#DA70D6">echo</FONT></B> -e <B><FONT COLOR="#BC8F8F">&quot;* Number of running tasks: \t$(echo `ps ax | wc -l` - 1 | bc)&quot;</FONT></B>
        <I><FONT COLOR="#B22222">#This fucks up the email
</FONT></I>        <I><FONT COLOR="#B22222">#echo &quot;* PS Tree:&quot;
</FONT></I>        <I><FONT COLOR="#B22222">#fpstree
</FONT></I>        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;* Running programs:&quot;</FONT></B>
        fcomms
        <B><FONT COLOR="#DA70D6">echo</FONT></B> -e <B><FONT COLOR="#BC8F8F">&quot;* CPU load: \t\t\t`TERM=linux top -n2 -b | grep 'Cpu' | tail -n1 | awk '{print $2+$4+$6}'`%&quot;</FONT></B>
        PROCS=`fprocs`
        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;* Process state:&quot;</FONT></B>
        <B><FONT COLOR="#DA70D6">echo</FONT></B> -e <B><FONT COLOR="#BC8F8F">&quot;\tRunning: \t\t`echo ${PROCS} | awk '{print $1}'`&quot;</FONT></B>
        <B><FONT COLOR="#DA70D6">echo</FONT></B> -e <B><FONT COLOR="#BC8F8F">&quot;\tSleeping: \t\t`echo ${PROCS} | awk '{print $2}'`&quot;</FONT></B>
        <B><FONT COLOR="#DA70D6">echo</FONT></B> -e <B><FONT COLOR="#BC8F8F">&quot;\tZombie: \t\t`echo ${PROCS} | awk '{print $3}'`&quot;</FONT></B>
        <B><FONT COLOR="#DA70D6">echo</FONT></B> -e <B><FONT COLOR="#BC8F8F">&quot;\tStopped: \t\t`echo ${PROCS} | awk '{print $4}'`&quot;</FONT></B>
        <B><FONT COLOR="#DA70D6">echo</FONT></B>
}

froute() {
        OFS=${<FONT COLOR="#B8860B">IFS</FONT>}
        <FONT COLOR="#B8860B">IFS</FONT>=$'\n'

        CNT=$(<B><FONT COLOR="#DA70D6">echo</FONT></B> `/sbin/route | wc -l` - 1 | bc)
        /sbin/route | tail -n ${CNT} | <B><FONT COLOR="#A020F0">while</FONT></B> <B><FONT COLOR="#DA70D6">read</FONT></B> -r a;
        <B><FONT COLOR="#A020F0">do</FONT></B>
                <B><FONT COLOR="#DA70D6">echo</FONT></B> -e <B><FONT COLOR="#BC8F8F">&quot;\t${a}&quot;</FONT></B>
        <B><FONT COLOR="#A020F0">done</FONT></B>

        <FONT COLOR="#B8860B">IFS</FONT>=${OFS}
}

sinetwork() {
        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;=================== Networking ================================&quot;</FONT></B>
        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;* Routing table:&quot;</FONT></B>
        froute
        <B><FONT COLOR="#DA70D6">echo</FONT></B>
}

simemory() {
        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;=================== Memory ====================================&quot;</FONT></B>
        RAMTOTAL=`<B><FONT COLOR="#DA70D6">echo</FONT></B> $(($(cat /proc/meminfo | grep MemTotal | awk '{print $2}')/1024))`
        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;* Ram:\t\t\t free of ${RAMTOTAL}Mb&quot;</FONT></B>
}

sidiskstats() {
        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;=================== Hard Disc =================================&quot;</FONT></B>
        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;* Disk Information:&quot;</FONT></B>
        OFS=${<FONT COLOR="#B8860B">IFS</FONT>}
        <FONT COLOR="#B8860B">IFS</FONT>=$'\n'
        df -h | grep -v ^none | <B><FONT COLOR="#A020F0">while</FONT></B> <B><FONT COLOR="#DA70D6">read</FONT></B> -r a;
        <B><FONT COLOR="#A020F0">do</FONT></B>
                <B><FONT COLOR="#DA70D6">echo</FONT></B> -e <B><FONT COLOR="#BC8F8F">&quot;\t${a}&quot;</FONT></B>
        <B><FONT COLOR="#A020F0">done</FONT></B>
        <FONT COLOR="#B8860B">IFS</FONT>=${OFS}
        <B><FONT COLOR="#DA70D6">echo</FONT></B>
        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;* Mounts:&quot;</FONT></B>
        OFS=${<FONT COLOR="#B8860B">IFS</FONT>}
        <FONT COLOR="#B8860B">IFS</FONT>=$'\n'
        mount | <B><FONT COLOR="#A020F0">while</FONT></B> <B><FONT COLOR="#DA70D6">read</FONT></B> -r a;
        <B><FONT COLOR="#A020F0">do</FONT></B>
                <B><FONT COLOR="#DA70D6">echo</FONT></B> -e <B><FONT COLOR="#BC8F8F">&quot;\t${a}&quot;</FONT></B>
        <B><FONT COLOR="#A020F0">done</FONT></B>
        <FONT COLOR="#B8860B">IFS</FONT>=${OFS}
        <B><FONT COLOR="#DA70D6">echo</FONT></B>
}

simd5() {
        <B><FONT COLOR="#A020F0">if</FONT></B> [ ! -e md5sums.lst ];
        <B><FONT COLOR="#A020F0">then</FONT></B>
                <B><FONT COLOR="#DA70D6">return</FONT></B>
        <B><FONT COLOR="#A020F0">fi</FONT></B>

        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;=================== MD5Sum Check ==============================&quot;</FONT></B>
        
        OFS=${<FONT COLOR="#B8860B">IFS</FONT>}
        <FONT COLOR="#B8860B">IFS</FONT>=$'\n'

        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;* Checking MD5 Sums&quot;</FONT></B>

        cat md5sums.lst | grep <B><FONT COLOR="#BC8F8F">&quot;^/&quot;</FONT></B> | <B><FONT COLOR="#A020F0">while</FONT></B> <B><FONT COLOR="#DA70D6">read</FONT></B> -r a;
        <B><FONT COLOR="#A020F0">do</FONT></B>
                F=`<B><FONT COLOR="#DA70D6">echo</FONT></B> ${a} | cut -d':' -f1`
                S=`<B><FONT COLOR="#DA70D6">echo</FONT></B> ${a} | cut -d':' -f2`
                S2=`md5sum ${F} | cut -d' ' -f1`
                <B><FONT COLOR="#DA70D6">echo</FONT></B> -n -e <B><FONT COLOR="#BC8F8F">&quot;\t${F}: \t\t\t\t&quot;</FONT></B>
                <B><FONT COLOR="#A020F0">if</FONT></B> [ <B><FONT COLOR="#BC8F8F">&quot;${S}&quot;</FONT></B> = <B><FONT COLOR="#BC8F8F">&quot;${S2}&quot;</FONT></B> ];
                <B><FONT COLOR="#A020F0">then</FONT></B>
                        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;[OK]&quot;</FONT></B>
                <B><FONT COLOR="#A020F0">else</FONT></B>
                        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;[INVALID]&quot;</FONT></B>
                <B><FONT COLOR="#A020F0">fi</FONT></B>                        
        <B><FONT COLOR="#A020F0">done</FONT></B>

        <FONT COLOR="#B8860B">IFS</FONT>=${OFS}
        <B><FONT COLOR="#DA70D6">echo</FONT></B>
}

summary() {
        siheader
        siuptime
        siusers
        sitasks
        sinetwork

        <I><FONT COLOR="#B22222">#simemory
</FONT></I>        sidiskstats

        simd5

        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;===============================================================&quot;</FONT></B>
        <B><FONT COLOR="#DA70D6">echo</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;* Brought to you by Ikke - http://www.eikke.com&quot;</FONT></B>
}

summary
</PRE>
<HR>
<ADDRESS>Generated by <A HREF="http://www.iki.fi/~mtr/genscript/">GNU enscript 1.6.3</A>.</ADDRESS>
</BODY>

<!-- Mirrored from code.eikke.com/bash/sysstats.sh.html by HTTrack Website Copier/3.x [XR&CO'2010], Tue, 11 Dec 2012 21:31:03 GMT -->
</HTML>
